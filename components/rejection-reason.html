<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>不互认理由记录</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }
        .main-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: #ffffff;
        }
        .reason-card {
            background-color: #fff;
            border: 1px solid var(--pb-border);
            border-radius: 3px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .reason-header {
            border-bottom: 1px solid var(--pb-border);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8fafc;
        }
        .reason-body {
            padding: 15px;
        }
        .reason-footer {
            border-top: 1px solid var(--pb-border);
            padding: 10px 15px;
            text-align: right;
            background-color: #f8fafc;
            font-size: 12px;
            color: var(--pb-gray);
        }
        .item-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 3px;
            font-size: 12px;
            color: #2b6cb0;
        }
        .hospital-badge {
            display: inline-block;
            padding: 2px 8px;
            background-color: #e9f7ef;
            border: 1px solid #c6f6d5;
            border-radius: 3px;
            font-size: 12px;
            color: #276749;
        }
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            color: var(--pb-gray);
            text-align: center;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #cbd5e0;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- 标题栏 -->
        <div class="pb-header">
            <div class="flex justify-between items-center">
                <div><i class="fas fa-clipboard-list mr-2"></i>不互认理由记录</div>
                <div class="flex items-center gap-2">
                    <button class="pb-button-secondary text-xs"><i class="fas fa-sync-alt mr-1"></i>刷新</button>
                    <button class="pb-button-secondary text-xs"><i class="fas fa-times mr-1"></i>关闭</button>
                </div>
            </div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content-area">
            <!-- 初始状态为空 -->
            <div id="emptyState" class="empty-state">
                <i class="fas fa-clipboard"></i>
                <h3 class="text-lg font-bold mb-2">暂无不互认记录</h3>
                <p>当您选择不互认检验项目时，理由将显示在此处</p>
            </div>
            
            <!-- 不互认理由列表 -->
            <div id="reasonList" style="display: none;">
                <!-- 理由卡片示例 -->
                <div class="reason-card" id="reason-template" style="display: none;">
                    <div class="reason-header">
                        <div>
                            <span class="item-badge" data-field="itemName">血常规</span>
                            <span class="hospital-badge" data-field="hospital">市第一医院</span>
                            <span class="ml-2 text-sm" data-field="date">2023-01-15</span>
                        </div>
                        <div>
                            <span class="pb-status pb-status-danger">不互认</span>
                        </div>
                    </div>
                    <div class="reason-body">
                        <h4 class="font-bold mb-2">不互认理由：</h4>
                        <p data-field="reasonText">检验结果异常，需重新检查</p>
                    </div>
                    <div class="reason-footer">
                        <span data-field="doctorInfo">操作医生：张医生 | 操作时间：2023-03-15 15:30</span>
                    </div>
                </div>
                
                <!-- 示例数据（已构建的理由卡片） -->
                <div class="reason-card">
                    <div class="reason-header">
                        <div>
                            <span class="item-badge">肝功能</span>
                            <span class="hospital-badge">市第一医院</span>
                            <span class="ml-2 text-sm">2023-01-15</span>
                        </div>
                        <div>
                            <span class="pb-status pb-status-danger">不互认</span>
                        </div>
                    </div>
                    <div class="reason-body">
                        <h4 class="font-bold mb-2">不互认理由：</h4>
                        <p>检验结果异常，需重新检查</p>
                    </div>
                    <div class="reason-footer">
                        <span>操作医生：张医生 | 操作时间：2023-03-15 15:30</span>
                    </div>
                </div>
                
                <div class="reason-card">
                    <div class="reason-header">
                        <div>
                            <span class="item-badge">甲状腺功能</span>
                            <span class="hospital-badge">市第二医院</span>
                            <span class="ml-2 text-sm">2023-01-20</span>
                        </div>
                        <div>
                            <span class="pb-status pb-status-danger">不互认</span>
                        </div>
                    </div>
                    <div class="reason-body">
                        <h4 class="font-bold mb-2">不互认理由：</h4>
                        <p>检验时间过久，需更新数据</p>
                    </div>
                    <div class="reason-footer">
                        <span>操作医生：李医生 | 操作时间：2023-03-14 10:15</span>
                    </div>
                </div>
            </div>
            
            <!-- 底部按钮区域 -->
            <div class="flex justify-end mt-4 gap-2">
                <button class="pb-button-secondary"><i class="fas fa-print mr-1"></i>打印记录</button>
                <button class="pb-button"><i class="fas fa-file-export mr-1"></i>导出为PDF</button>
            </div>
        </div>
    </div>
    
    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 理由记录数据
            const reasonRecords = [];
            
            // 接收来自互认项目列表的消息
            window.addEventListener('message', function(event) {
                // 确保消息来源可信
                if (event.origin !== window.location.origin) return;
                
                const { action, data } = event.data;
                
                if (action === 'openReasonInput') {
                    // 接收到不互认理由
                    console.log('接收到不互认理由', data);
                    
                    // 添加记录
                    addReasonRecord(data);
                }
            });
            
            // 添加不互认理由记录
            function addReasonRecord(data) {
                const record = {
                    id: data.itemId,
                    reason: data.reason,
                    itemName: getItemNameById(data.itemId),
                    hospital: getHospitalById(data.itemId),
                    date: getDateById(data.itemId),
                    doctor: '张医生',
                    timestamp: new Date().toLocaleString()
                };
                
                reasonRecords.push(record);
                
                // 更新UI
                updateUI();
            }
            
            // 根据ID获取项目名称（模拟）
            function getItemNameById(id) {
                const items = {
                    '1': '血常规',
                    '2': '肝功能',
                    '3': '血常规',
                    '4': '甲状腺功能'
                };
                return items[id] || '未知项目';
            }
            
            // 根据ID获取医院（模拟）
            function getHospitalById(id) {
                const hospitals = {
                    '1': '市第一医院',
                    '2': '市第一医院',
                    '3': '市第二医院',
                    '4': '市第二医院'
                };
                return hospitals[id] || '未知医院';
            }
            
            // 根据ID获取日期（模拟）
            function getDateById(id) {
                const dates = {
                    '1': '2023-01-15',
                    '2': '2023-01-15',
                    '3': '2023-01-20',
                    '4': '2023-01-20'
                };
                return dates[id] || '未知日期';
            }
            
            // 更新UI显示
            function updateUI() {
                const emptyState = document.getElementById('emptyState');
                const reasonList = document.getElementById('reasonList');
                
                if (reasonRecords.length > 0) {
                    // 有记录，隐藏空状态
                    emptyState.style.display = 'none';
                    reasonList.style.display = 'block';
                    
                    // 创建新的理由卡片
                    const template = document.getElementById('reason-template');
                    const newRecord = reasonRecords[reasonRecords.length - 1];
                    
                    const card = template.cloneNode(true);
                    card.id = `reason-${newRecord.id}`;
                    card.style.display = 'block';
                    
                    // 设置卡片内容
                    card.querySelector('[data-field="itemName"]').textContent = newRecord.itemName;
                    card.querySelector('[data-field="hospital"]').textContent = newRecord.hospital;
                    card.querySelector('[data-field="date"]').textContent = newRecord.date;
                    card.querySelector('[data-field="reasonText"]').textContent = newRecord.reason;
                    card.querySelector('[data-field="doctorInfo"]').textContent = `操作医生：${newRecord.doctor} | 操作时间：${newRecord.timestamp}`;
                    
                    // 添加到列表最前面
                    reasonList.insertBefore(card, reasonList.firstChild);
                }
            }
        });
    </script>
</body>
</html> 